{"componentChunkName":"component---src-templates-post-index-js","path":"/2018/09/load-more/","result":{"data":{"markdownRemark":{"id":"2ec18ec5-8cf2-5fa3-b84f-6df2bb33ba72","html":"<p>I make blog layouts a lot and wanted a nicer way of loading new posts without loading a new page. I also wanted to do that without using jQuery. So I wrote a script to load more posts for static site generators.</p>\n<hr/>\n<h2>The Setup</h2>\n<pre><code>&#x3C;section>\n  &#x3C;div class=\"posts__container\">\n    &#x3C;!-- Posts Here -->\n  &#x3C;/div>\n  &#x3C;span class=\"posts__next\">Load More Articles&#x3C;/span>\n&#x3C;/section>\n</code></pre>\n<p>There is also the option to add some CSS. The script currently adds the class <code>js-posts-loading</code> to <code>posts__next</code> when the user clicks it. A spinner can be added to show the posts are loading. The class will be removed when the posts are finished loading. And there is a CSS keyframe animation named <code>fade-up</code> that has to be written and can be changed to something else.</p>\n<hr/>\n<h2>The Script</h2>\n<p>There needs to be a variable called <code>maxPages</code> before the script for this to work. In this version I am just adding the variable at the end of the HTML, but I have also used it as data attributes on the posts container and returned the value in the settings object.</p>\n<pre><code>// Jekyll\nvar maxPages = parseInt('&#x26;#x7B;&#x26;#x7B; paginator.total_pages &#x26;#x7D;&#x26;#x7D;');\n\n// Ghost\nvar maxPages = parseInt('&#x26;#x7B;&#x26;#x7B; pagination.pages &#x26;#x7D;&#x26;#x7D;');\n</code></pre>\n<pre><code>const LoadMore = (() => {\n  let s;\n\n  return {\n    settings() {\n      return {\n        container: document.querySelector('.posts__container'),\n        next: document.querySelector('.posts__next'),\n        class: 'js-posts-loading',\n        animation: 'fade-up',\n        currentPage: 1,\n        pathname: window.location.pathname.replace(/#(.*)$/g, '').replace('//g', '/'),\n        isLoading: false\n      };\n    },\n\n    init() {\n      s = this.settings();\n      this.bindEvents();\n    },\n\n    bindEvents() {\n      s.next.addEventListener('click', () => {\n        this.requestPosts();\n      });\n    },\n\n    requestPosts() {\n      if (s.isLoading || s.currentPage === maxPages) {\n        return;\n      }\n\n      s.isLoading = true;\n      s.currentPage++;\n\n      const request = new XMLHttpRequest();\n      const nextPage = `${s.pathname}page/${s.currentPage}/`;\n\n      request.open('GET', nextPage, true);\n      request.send();\n\n      request.onreadystatechange = () => {\n        if (request.readyState &#x3C; 4) {\n          s.next.classList.add(s.class);\n        } else if (request.readyState === 4 &#x26;&#x26; request.status === 200) {\n          const parse = document.createRange().createContextualFragment(request.response);\n          const posts = parse.querySelectorAll('.posts__post');\n\n          if (posts.length) {\n            setTimeout(() => {\n              [].forEach.call(posts, post => {\n                post.classList.add(s.animation);\n                s.container.appendChild(post);\n              });\n\n              s.next.classList.remove(s.class);\n\n              if (s.currentPage === maxPages) {\n                const child = document.querySelector('.posts__pagination');\n\n                child.parentNode.removeChild(child);\n              }\n            }, 750);\n          }\n        } else {\n          console.error(`${request.status} – ${request.statusText}`);\n        }\n      }\n\n      s.isLoading = false;\n    }\n  };\n})();\n\nLoadMore.init();\n</code></pre>\n<hr/>\n<h2>Demos</h2>\n<p><a href=\"http://barber.samesies.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Barber</a> – Custom Blog for <a href=\"https://github.com/samesies/barber-jekyll\" target=\"_blank\" rel=\"noopener noreferrer\">Jekyll</a> and <a href=\"https://github.com/samesies/barber-ghost\" target=\"_blank\" rel=\"noopener noreferrer\">Ghost</a></p>\n<p><a href=\"https://github.com/samesies/Casper\" target=\"_blank\" rel=\"noopener noreferrer\">Casper</a> – Fork of Ghost Blog</p>","frontmatter":{"title":"Load More","description":"","date":"September 2018","image":{"id":"8b3ef962-d0df-5c73-b6ee-96e478db4095","publicURL":"/static/load-more-7946ef8286dac708b8eb51de7f61ca8e.jpg"}},"fields":{"slug":"/2018/09/load-more/"}}},"pageContext":{"slug":"/2018/09/load-more/"}}}